<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=898ef3f58fbd61e694f90c5384670dc7&libraries=clusterer,services,drawing"></script>
</head>

<div id="realty_new" layout:fragment="content">
    <div class="container">
        <div class="col-md-4">
            <input type="text" placeholder="위치" class="input-address form-control">
            <button type="submit" class="search-address btn btn-success">검색</button>
        </div>

        <div id="map" style="width:500px;height:500px;"></div>

        <div class="col-md-4">
            <form>
                위도 <input type="text" name="lat" th:readonly="readonly" class="input-lat form-control">
                경도 <input type="text" name="lng" th:readonly="readonly" class="input-lng form-control">
                물건이름 <input type="text" name="realty_name" class="input-realty-name form-control">
                주소 <input type="text" name="address1" class="input-address1 form-control">
                <button type="button" class="copy-address btn btn-success">복사</button>
                상세내용 <textarea name="realty-content" class="input-realty-content form-control"></textarea>
            </form>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        /* ]]> */
    </script>

    <script type="text/javascript">
        var container = document.getElementById('map');
        var options = {
            center: new daum.maps.LatLng(33.450701, 126.570667),
            level: 3
        };

        var map = new daum.maps.Map(container, options);
        // map.setZoomable(false); // 확대/축소 막기, 더블클릭을 통한 확대는 막을 수 없다

        // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
        var zoomControl = new daum.maps.ZoomControl();
        map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);

        // 지도를 클릭한 위치에 표출할 마커
        var marker = new daum.maps.Marker({
            position: map.getCenter()
        });

        // 마커가 지도 위에 표시되도록 설정합니다
        marker.setMap(map);

        // 마커가 드래그 가능하도록 설정합니다
        marker.setDraggable(true);

        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new daum.maps.services.Geocoder();

        // 검색 버튼 클릭
        $('.search-address').on('click', function () {
            var address = $('.input-address').val();

            // 주소로 좌표를 검색합니다
            geocoder.addressSearch(address, function (result, status) {

                // 정상적으로 검색이 완료됐으면
                if (status === daum.maps.services.Status.OK) {

                    var lat = result[0].y;
                    var lng = result[0].x;

                    var coords = new daum.maps.LatLng(lat, lng);

                    // 결과값으로 받은 위치를 마커로 표시합니다
                    marker.setPosition(coords);
                    // marker = new daum.maps.Marker({
                    //     map: map,
                    //     position: coords
                    // });

                    // // 인포윈도우로 장소에 대한 설명을 표시합니다
                    // var infowindow = new daum.maps.InfoWindow({
                    //     content: '<div style="width:150px;text-align:center;padding:6px 0;">테스트 위치</div>'
                    // });
                    // infowindow.open(map, marker);

                    $('.input-lat').val(lat);
                    $('.input-lng').val(lng);

                    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                    map.setCenter(coords);
                } else {
                    $('.input-lat').val('');
                    $('.input-lng').val('');

                    alert('주소 검색에 실패하였습니다.');
                }

            });
        });

        // 주소 복사
        $('.copy-address').on('click', function() {
           $('.input-address1').val($('.input-address').val());
        });

        // // 주소로 좌표를 검색합니다
        // geocoder.addressSearch('서울특별시 구로구 디지털로31길 90', function (result, status) {
        //
        //     // 정상적으로 검색이 완료됐으면
        //     if (status === daum.maps.services.Status.OK) {
        //
        //         var coords = new daum.maps.LatLng(result[0].y, result[0].x);
        //
        //         // 결과값으로 받은 위치를 마커로 표시합니다
        //         marker.setPosition(coords);
        //         // marker = new daum.maps.Marker({
        //         //     map: map,
        //         //     position: coords
        //         // });
        //
        //         // // 인포윈도우로 장소에 대한 설명을 표시합니다
        //         // var infowindow = new daum.maps.InfoWindow({
        //         //     content: '<div style="width:150px;text-align:center;padding:6px 0;">테스트 위치</div>'
        //         // });
        //         // infowindow.open(map, marker);
        //
        //         // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
        //         map.setCenter(coords);
        //     }
        //
        // });

        // 마커에 드래그 종료 이벤트를 등록합니다
        daum.maps.event.addListener(marker, 'dragend', function () {

            // 드래그한 위도, 경도 정보를 가져옵니다
            var latlng = marker.getPosition();

            var lat = latlng.getLat();
            var lng = latlng.getLng();

            var message = '드래그한 위치의 위도는 ' + lat + ' 이고, ';
            message += '경도는 ' + lng + ' 입니다';

            console.info(message);

            $('.input-lat').val(lat);
            $('.input-lng').val(lng);

        });

        // 지도에 클릭 이벤트를 등록합니다
        // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
        daum.maps.event.addListener(map, 'click', function (mouseEvent) {

            // 클릭한 위도, 경도 정보를 가져옵니다
            var latlng = mouseEvent.latLng;

            // 마커 위치를 클릭한 위치로 옮깁니다
            marker.setPosition(latlng);

            var lat = latlng.getLat();
            var lng = latlng.getLng();

            var message = '클릭한 위치의 위도는 ' + lat + ' 이고, ';
            message += '경도는 ' + lng + ' 입니다';

            console.info(message);

            $('.input-lat').val(lat);
            $('.input-lng').val(lng);

        });

        // 지도가 이동, 확대, 축소로 인해 중심좌표가 변경되면 마지막 파라미터로 넘어온 함수를 호출하도록 이벤트를 등록합니다
        daum.maps.event.addListener(map, 'idle', function () {

            // 지도 영역정보를 얻어옵니다
            var bounds = map.getBounds();

            // 영역정보의 남서쪽 정보를 얻어옵니다
            var swLatlng = bounds.getSouthWest();

            // 영역정보의 북동쪽 정보를 얻어옵니다
            var neLatlng = bounds.getNorthEast();

            var message = '<p>영역좌표는 남서쪽 위도, 경도는  ' + swLatlng.toString() + '이고 <br>';
            message += '북동쪽 위도, 경도는  ' + neLatlng.toString() + '입니다 </p>';

            console.info(message);

        });

    </script>
</th:block>

</html>
